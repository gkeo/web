# 专门开一贴，群晖硬软件的的各种坑及解决方案 - 电脑讨论 - Chiphell - 分享与交流用户体验
\| _本帖最后由 spacer 于 2021-9-2 23:01 编辑_  

在 Chiphell 这么久了，也希望能对大家有点贡献，作为一个白群晖 6 年的老用户，大家都说群晖是买软件送硬件，那么这么多年来给群晖捐了不少 “软件授权费”，DS415+，DS216，DS916+，DS1819+，DX517，RX418，决定在这里发个帖子，希望能够帮助到大家避开可能的各种坑。  

![](https://static.chiphell.com/forum/202108/31/110837eqoxo8tcnaaccx28.jpeg)

**WechatIMG201.jpeg** _(226.24 KB, 下载次数: 0)_

2021-8-31 11:08 上传

**适用对象：**    白群晖用户，不愿意折腾，对数据敏感性较强（装了很多家庭照片，文件，宝贵的\*\*姐们）；  
**不适用对象：** 黑群用户，有些问题会涉及到硬件，由于黑群配置差异极大，很难找到原因；关于硬件推荐：本人与群晖无任何商业联系，因此不在此帖推荐任何硬件，只是以个人角度说一下使用过硬件的一些优缺点；  
**最后更新日期：**  2021 年 9 月 2 日 （DSM 7.0 , 以群晖的牙膏性，这篇文章应该在未来 2 年都不会过时）；  

* * *

**不折腾玩转群晖 NAS 的通用建议：** 

-   **用企业级硬盘：** 多花点钱买企业级硬盘，现在 10-16T 的企业级硬盘价格真的不贵，耐心搜索本版帖子就能找到靠谱商家的合适价格（2021 年 9 月差不多 120 块钱 1T）。既然是用白群了，那就要知道群晖的是根据盘位费卖硬件的，尽量不要用普通硬盘，尤其是淘汰下来的 N 年旧硬盘做 NAS，问题多多，每月都有人求助群晖 “存储空间损毁” 的问题。另外，NAS 盘，除了对静音有极致要求，现在也不推荐，不仅价格贵，性能低、还吃了好多亏（SMR 红盘坏了好几块）。
-   **加内存是性价比最高的性能提升方式：** 群晖有一篇非常冷门的[文章](https://global.download.synology.com/download/Document/Software/WhitePaper/Firmware/DSM/All/enu/Increasing_System_Performance_of_Synology_NAS_Solution_Guide_enu.pdf)，提到了 RAID / 网络 / 内存对性能的影响，简单的总结就是，8G->16G 内存，性能可以提升 30% 以上，16G->32G 内存，写性能还能提升 30%。当然这个测试都是基于 “旗舰级” 硬件测试的，但对于家用机，200 多块钱的内存升级仍是最有效的性能提升方式，推荐大家无脑堆到支持内存的上限。
-   **RAID 不是数据保险箱：** \*\*姐有价，数据无价，如果真的想要保护数据，仅靠 NAS 是不够的，RAID 而是用来保证某硬盘损坏时候依然能提供相关服务，而不是用来保证数据不丢的。为了数据安全，切记使用[“3-2-1” 法则](https://post.**.com/p/686500/)保证数据安全。否则接收开盘数据恢复价格 1T=1k；
-   **群晖机器的性价比计算方式是价格 / 盘位：** 群晖各阶机型 CPU 性能差异不太明显，但后期扩充盘位费极贵。因此简单计算性价比的方式就是价格 / 盘位，从而能比较出 2、4、5、6、8 盘位机器的性价比。注意只关注主机有多少个盘位，不要把扩展 DX517 这种算进去，大部分家庭用户很难再去买一个 DX517 用于扩容，所以不要想着买两盘位的 720+，想着未来在买一个 DX517 做成 7 盘位，应该直接买 1621 + 直接上到 6 盘位。
-   **磁盘空间可选择 btrfs：** 家庭用户可以安全使用 btrfs，具有重复文件不占用空间，静默错误自动修复等有用功能。同时如果需要使用群晖虚拟机，创建的磁盘空间必须是 btrfs
-   买一个 UPS 把：如果有空间，APC 的 BK650 搞一台把，与群晖无缝对接，设置方便
-

* * *

**群晖 m2 SSD 缓存避坑指南**

\***\* 很多高阶机器自带 2 个 nvme SSD 槽位，但这玩意儿非常鸡肋 (以 DSM6.2 版本，DSM7.0 还没测试）：\*\***

-   nvme ssd 不能做存储空间，只能做缓存
-   **数据安全的角度，建议做只读缓存：** 

    群晖 nvme SSD 缓存有 2 种，一种读缓存，只需要 1 个 SSD 就可以，另外一种是读写缓存，需要 2 个容量一样的 SSD，而且只能为一个存储空间加速（不像隔壁家有分层存储技术）。鉴于 99% 的人不会在 RAID 中设定多个存储空间，所以这个问题倒也影响不大。但读缓存是可以随时拆，随时换，不影响到数据安全。而读写缓存是和存储空间并在一起的（据说 7.0 的会做调整），也就是说如果 ssd 突然暴毙，或者脑抽关机拆了一个 SSD，与读写缓存相连的这个存储空间会挂掉（数据可修复，但需要 linux 知识），很多人会用一个一些垃圾主控真香盘作为缓存（谁不是呢。。反正放着也是放着），读写缓存就会导致数据安全的问题。从性能的角度，不建议做读写缓存：另一方面，读写缓存究竟对 918 + 这种 J3455 的主机有多大帮助呢？我分析了读写缓存的机制，测试，以及 reddit 网友的各方面评论，结论是读写缓存主要是在群晖用于网页服务，iscsi，虚拟机的情况下有较好的加速作用，但是以目前群晖的牙膏机能，配置 nvme 的家用机型，这三样跑起来都很慢，因此读写缓存聊大于无。大部分家用场景，做读缓存就够了，读写缓存没有任何帮助，反而增加了存储空间挂掉的风险。
-   **缓存要保留一定的未分配空间，防止写入放大：关于**群晖的 nvme 缓存，本人血泪教训已经挂了 5 块不同牌子的 SSD，都表现为写入量很少，但是 health 0% 的情况，无法再用于群晖缓存，这些 SSD 可以拔下来插到普通电脑上去继续用，但是每次启动都要按 F1。经过和网友的相关交叉比对，应该是因为群晖的坑导致的写入放大所导致。也就是群晖的缓存自动释放速度很慢，当缓存占用率 99% 后，会反复对一些块进行移除，写入，导致 health 下降。**解决的办法是在配置 ssd 缓存的时候，不要把所有的空间完全都分配给缓存，建议只分配 80%，这样能有效的避免这个问题。**   

* * *

**2 盘位篇指南**

-   **群晖 2 盘位机器是能放入部分弱电箱的：** 群晖放弱电箱是普通家庭 NAS 入门的一个好选择。本人在装修时用的是某牌子的 HIBT-G16P 弱电箱，正好能将 218 + 及光猫，POE 交换机都放在一起（但这个弱电箱是铁门，不能放无线路由），夏天实测内部温度 40~50 度，不需要额外风扇散热。所以新装修用户，可以注意一下弱电箱深度，预留好空间。
-   **2 盘位最强机型 DS220+/DS720 + 应该怎么选：** 指导价分别是 2780/3680，720 + 是多了 2 个核，多了 2 个 NVME SSD 槽，支持群晖扩展硬件 (鸡肋)。在空间有限的情况下，推荐 DS720+，否则直接跳到 4/5 盘位篇，720 + 性价比太低。
-   **2 盘位机型部署建议：** 在家用环境下，USB3.0 口可以外接硬盘，作为群晖 download station 缓存，720 + 还有 esata 口，理论上还可以再接一块硬盘（本人未有时间测试），因此可以充分利用，最大化扩展性，由于群晖的 m2 口只能作为缓存，不能作为虚拟机运行环境，在 2 盘位机型中很鸡肋，远不如直接换装 SSD；  


-   **普通用户 -** 2 硬盘 SHR(相当于 RAID 1，只能获得 1 块硬盘的空间），有 PT 下载需求的，USB 口外接移动 sata SSD 移动硬盘作为缓存盘；
-   **All in One 使用者 -** 第一盘位安装 SATA SSD 作为虚拟机用途，第二盘位安装大容量 HDD，都是 basic 模式，USB/esata 外接 HDD 硬盘扩容；
-   **空间敏感型用户 -** 2 硬盘均使用独立 BASIC 以获得最大使用空间，USB 口外接移动 SSD sata 移动硬盘作为 download station 缓存；注意使用 HDD 会触发 BASIC 的坑（见下）  


-   _**Basic 模式下的坑：磁盘损毁后的数据备份操作极其复杂：** _首先，群晖的磁盘损毁判断机制设定的阈值非常高，只要有少量几个块出现读写缓慢，就会自动将此硬盘设定为 “磁盘损毁”，但是群晖平时 SMART 自检又特别的松，基本上不糊提示。本人好几个盘损毁，但上台式机检查，都没有任何问题。另外群晖经常会出现莫名其妙的“掉盘” 现象，就是突然提示硬盘已拔出。在这种情况下，如果是 shr 或者 raid，直接重新插进去就可以了，但是 basic 模式下，这块盘的数据就只能上 linux 系统去恢复，这个操作对于小白来说难度比较大，另外还有一种办办就是把盘插回去，然后用 ssh 的 mdadm 命令强行修复，可以强行把这个盘让群晖认出来，但需要一定的 linux 知识（参考 [这个帖子](https://blogs.dbcloudsvc.com/life/fixed-the-crashed-basic-volume-of-synology-nas/) 和 这[个帖子](https://www.dsebastien.net/2015/05/19/recovering-a-raid-array-in-e-state-on-a-synology-nas/)），我就不展开说了，有需要以后单独开一贴。
-   _**Basic 模式下的坑：App 数据的问题：** _群晖的系统是每个盘都有一个备份的，但是 APP 和相关数据是仅放在一个存储空间里的（包括 download station，moment 的照片索引数据），在硬盘没有问题的情况下，可以通过 “套件中心”-“常规”-“默认存储空间” 进行修改。但是如果 basic 模式，存放 app 数据的那块硬盘挂了，你就会发现此时无法修改 app 的默认存储空间，如果不具备一定 linux 知识（通过 madam 强行修复)，极大概率这些索引数据就没有了，几年的照片索引分类就白做了。
-   **Basic 和 SHR 转换：** Basic 是支持直接升级为 SHR 的，反之不行。如果你目前已经做的是 Basic 模式，需要转换 SHR（两盘位相当于 RAID 1），你要做的就是把一个盘位的数据 copy 到移动硬盘里，或者拷贝到另外一个盘里，然后关机，卸下一个硬盘，装新的大硬盘，开机后就可以选择升级为 SHR，参考[官方的教程](https://www.synology.com/zh-cn/knowledgebase/DSM/help/DSM/StorageManager/storage_pool_change_raid_type)。但是注意，你这么做硬盘容量是没有增加的，参考官方[存储容量计算器](https://www.synology.com/zh-cn/support/RAID_calculator?hdds=2%20TB|10%20TB)。比如你 4TB basic - 2T(A)+2T(B) ，升级为 2T(A) + 8T shr 后，实际可用容量反只有 2TB。需要再操作一遍，把 2T(A) 的数据移到 8T, 然后再把 2T(A) 更换成 8T，这样最终才能有 8T 的容量。  

* * *

**4 盘 / 5 盘位篇指南**

-   4/5 盘位机型部署建议：  


-   **普通用户** - 4 硬盘 SHR(相当于 RAID 5，只能获得 3 块硬盘的空间），有 PT 下载需求的，USB 口外接移动 sata SSD 移动硬盘作为缓存盘，注意数据备份
-   **All in One 使用者** -    第一盘位安装 SATA SSD 作为虚拟机用途，其余盘位做 SHR(RAID5)；
-   **SHR(RAID 5) 从数据安全的角度，采用消费级硬盘做 RAID5 有一定的重建失败率，需要注意这个坑：**  首先 RAID 不是用来保证数据不丢的，而是用来保证硬盘损坏时候依然能提供相关服务。为了数据安全，切记使用 “3-2-1” 法则保证数据安全  在有冷备份数据的情况下，群晖下做 SHR 比 Basic 要省心的多，但是呢，消费级硬盘与企业级硬盘相比，在 RAID 损毁的时候，重建有一定概率失败，导致整个阵列挂掉（计算器）。其实，这个风险是由于操作不正确引起的。永远记住，群晖 RAID 提示存储空间降级后，第一时间，找个移动硬盘，把所有数据拷出来，然后再换盘重建。我看论坛上各种血泪帖子，都是在没有数据备份的情况下，贸然重建引起的。  

* * *

**6 + 盘位机器**

\*\* 如何把牙膏的性能发挥到极致

背景：如果有条件购买到 1621+，1821 + 之类的多盘位机型，盘位是够了，但群晖毕竟是买软件送硬件的，性能较弱怎么办？\*\*

-   **不要犹豫，内存加满：** 群晖的内存 swap 既充当了读缓存，所以不要犹豫，加到机型支持的最大内存。一般是 16X2= 32GB，买 ECC 的内存。注意部分内存有兼容性问题，大家可以回帖帮助群友买到合适内存。
-   **PCI-e 优先万兆，不要搞 SSD 缓存：** 如果你的机型不支持新出的[E10M20-T1](https://www.synology.cn/zh-cn/products/E10M20-T1) SSD & 万兆二合一卡，那 pci-e 优先加万兆网卡，为什么？往上看缓存的坑。
-   **如果盘位富裕，1 号盘位建议用 sata SSD 代替：** 群晖的机制是默认从 1 号盘位开始读系统，然后 app 的缓存都是默认放在存储空间 1 内的。通常情况下，HDD 做的 RAID 随机读写性能很一般。建议如果盘位够的用户（比如 1618+,1819+）之类的，可以考虑放个 SSD 到 1 号盘位，设定为 basic 存储空间，用于套件及及各类缓存。2-8 号盘位做 HDD RAID（RAID 6），这样的话，在日常使用，能显著提升系统的响应效能，比 nvme 缓存效率要高很多。
-

* * *

**RS 机柜系列机器建议**

**我知道 CHH 有很多强迫症和土豪**

**如果你考虑 RS 系列，那请确保你自己 1）不差钱；2）从来不关注性价比；3. 有强迫症；**

-   RS1221 + 是家中有机柜，但没有独立房间 / 地下室放机柜环境下比较好的选择。最近听了一下噪音，共振和风扇噪音比 DS1821 + 略好一点，硬盘炒豆子声更明显一点，如果你买带前玻璃的机柜，可以缓解。另外我觉得这个产品针对的主要用户是：有强迫症但不会布线的机柜小白；目前看起来 plus 系列就只有这一款可以选择。
-   XS/XS + 系列，应该没有家庭用户购买吧，CPU 用的是 15 年的 intel 牙膏 D-15XX，完全没特色，如果有买的土豪请告诉我你的用途；  

相关帖子：[群晖 RS1221 + 开箱（有拆解，可以用于估算实际大小）](https://www.chiphell.com/thread-2308188-1-1.html)  

**群晖套件相关**

-   群晖 DS video DTS 的坑： 待补充
-   群晖 Download station 的坑：待补充
-   群晖 Drive 的坑：待补充  

如果大家有什么硬件的疑问，也可以回复，我不是商家，尽量以客观的角度给到大家建议。群晖从来没有联系过我，回答过我在他家官方论坛的技术问题，或者邀请过我参加他家的任何新品活动，或者提供我任何产品试用。  

 \| 
 [https://www.chiphell.com/thread-2187138-1-1.html](https://www.chiphell.com/thread-2187138-1-1.html)
